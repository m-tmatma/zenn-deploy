---
title: "å·¨å¤§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åˆ†å‰²åœ§ç¸®"
emoji: "ğŸ˜Š"
type: "tech"
topics:
  - "linux"
  - "tar"
  - "split"
  - "zstd"
published: true
published_at: "2022-04-14 09:55"
---

# å·¨å¤§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åˆ†å‰²åœ§ç¸®

## æ¦‚è¦

å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€å¤§é‡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ tar ã§åœ§ç¸®ã‚’æœ‰åŠ¹ã«ã—ã¦å›ºã‚ã‚‹ã¨æ¿€ã—ã CPUã€ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»ã—ã¦ãªã‹ãªã‹å®Œäº†ã—ã¾ã›ã‚“ã€‚`tar` + `split` + åœ§ç¸®ã‚³ãƒãƒ³ãƒ‰(ã“ã“ã§ã¯ `zstd`) ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§æ¯”è¼ƒçš„é€Ÿãåœ§ç¸®ã—ãªãŒã‚‰å›ºã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

tar ã«å›ºã‚ãªãŒã‚‰ `split` ã‚³ãƒãƒ³ãƒ‰ã§åˆ†å‰²ã™ã‚‹ã“ã¨ã§ä¸€å›å½“ãŸã‚Šã®åœ§ç¸®å¯¾è±¡ã‚’å°ã•ãæŠ‘ãˆãªãŒã‚‰åœ§ç¸®ã™ã‚‹ã“ã¨ã§å‡¦ç†æ™‚é–“ã‚’ç¯€ç´„ã§ãã¾ã™ã€‚

## çµè«–

### æœ€çµ‚å½¢ã®ã‚³ãƒãƒ³ãƒ‰ä¾‹

ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã‚’ tar ã§å›ºã‚ãªãŒã‚‰ 1GB ãšã¤ã«åˆ†å‰²ã—ã¦å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ zstd ã§åœ§ç¸®ã—ã¦ã€`../target.tar000.zst`, `../target.tar001.zst`, `../target.tar002.zst`, ... ã«å‡ºåŠ›ã™ã‚‹å ´åˆã®ã‚³ãƒãƒ³ãƒ‰ä¾‹

```
tar -cf - . | split -a 3 -d -b 1G --filter='zstd > $FILE.zst' - ../target.tar
```

ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å¯¾è±¡ã‹ã‚‰ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚¡ãƒ«ãƒ€ã‚’é™¤å¤–ã™ã‚‹å ´åˆã¯ `tar -cf - .` ã®éƒ¨åˆ†ã§ `tar --exclude='*.sock' -cf - .` ãªã©ã€ `--exclude=` ã§é™¤å¤–æŒ‡å®šã—ã¾ã™ã€‚

### åˆ†å‰²åœ§ç¸®ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®è§£å‡

åœ§ç¸®ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«zstã‚’åˆ—æŒ™ã—ã¦ `zstdcat` ã§æ¨™æº–å‡ºåŠ›ã«ä¸€æ‹¬ã§å‡ºåŠ›ã—ã¦ `tar xvf` ã§å±•é–‹ã™ã‚‹ã€‚
`tar xvf` ã® `v` ã¯çœç•¥å¯èƒ½ã€‚

```
mkdir temp
cd temp
ls ../*.zst | xargs zstdcat | tar xvf -
```

## èª¬æ˜

### zstd

å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’é«˜é€Ÿã«åœ§ç¸®ã™ã‚‹ãŸã‚ã« faceboook ã® [zstd](https://facebook.github.io/zstd/) ã‚’ä½¿ã„ã¾ã™ã€‚

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• (ubuntu 21.10)

ä»¥ä¸‹ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```
sudo apt install -y zstd
```

#### å‚è€ƒ


https://github.com/facebook/zstd

https://facebook.github.io/zstd/

https://www.manpagez.com/man/1/zstd/


### split

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• (ubuntu 21.10)

GNU Coreutils ã®ä¸€éƒ¨ãªã®ã§ã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã¯ãšã€‚

#### å‚è€ƒ

https://linuxjm.osdn.jp/html/GNU_coreutils/man1/split.1.html


#### ä½¿ã„æ–¹

https://linuxjm.osdn.jp/html/GNU_coreutils/man1/split.1.html

* `-b SIZE` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ `SIZE` ãƒã‚¤ãƒˆæ¯ã«ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ†å‰²ã—ã¾ã™ã€‚
* `-d` ã‚’æŒ‡å®šã™ã‚‹ã¨ 0 ã§å§‹ã¾ã‚‹æ¥å°¾è¾ã‚’ä»˜ã‘ã¾ã™ã€‚
* `--filter=COMMAND` ã§åˆ†å‰²ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ COMMAND ã§æŒ‡å®šã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `$FILE` ã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚

`--filter='zstd > $FILE.zst'` ã®ã‚ˆã†ã«ã™ã‚‹ã¨åˆ†å‰²ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ zstd ã§åœ§ç¸®ã—ã¦ã€æ‹¡å¼µå­ zst ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

### tar ã§å›ºã‚ãªãŒã‚‰ã€split ã§åˆ†å‰²ã—ã¦ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ zstd ã§åœ§ç¸®ã™ã‚‹


```
tar -cf - . | split -a 3 -d -b 1G --filter='zstd > $FILE.zst' - ../target.tar
```

* `tar -cf - .` ã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å®¹ã‚’ tar ã§å›ºã‚ã¦æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã—ã¾ã™ã€‚
* `split` ã‚³ãƒãƒ³ãƒ‰ã§ 1GB å˜ä½ã«ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ†å‰²ã—ã¾ã™ã€‚
* `--filter='zstd > $FILE.zst'` ã§åˆ†å‰²å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `zstd` ã§åœ§ç¸®ã—ã¾ã™ã€‚
* prefix ã¨ã—ã¦ `../target.tar` ã«å‡ºåŠ›ã—ã¾ã™ã€‚
* `-a 3` ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§æ¥å°¾è¾ã¯ 3æ¡ã«ãªã‚Šã¾ã™ã€‚(`000`, `001`, `002`, ...) (çœç•¥ã—ãŸå ´åˆã¯ 2 æ¡ã«ãªã‚Šã¾ã™)
* æœ€çµ‚çš„ãªçµæœã¨ã—ã¦ã¯ `../target.tar000.zst`, `../target.tar001.zst`, `../target.tar002.zst`, ... ã¨ãªã‚Šã¾ã™ã€‚

#### å‚è€ƒ


https://blog.putise.com/linux%E3%81%A7%E5%9C%A7%E7%B8%AE%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E5%88%86%E5%89%B2%E3%81%99%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89/

https://linuxjm.osdn.jp/info/GNU_coreutils/coreutils-ja_31.html

https://uxmilk.jp/8584

https://atmarkit.itmedia.co.jp/ait/articles/1711/24/news016.html