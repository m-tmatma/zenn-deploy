---
title: "pycrc.py ã§CRCè¨ˆç®—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹"
emoji: "ğŸ“‘"
type: "tech"
topics:
  - "python"
  - "crc"
  - "pycrc"
published: true
published_at: "2021-09-25 18:56"
---

# pycrc.py ã§CRCè¨ˆç®—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹

CRC(=Cyclic Redundancy Code) ã¯èª¤ã‚Šæ¤œå‡ºç¬¦å·ã®ä¸€ç¨®ã ãŒã€ç”¨é€”ã«ã‚ˆã£ã¦ã„ã‚ã‚“ãªæ–¹æ³•ãŒå­˜åœ¨ã™ã‚‹ã€‚

CRCè¨ˆç®—ã«ã‚ˆã£ã¦ã¯ã€è¨ˆç®—ã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç•°ãªã‚Šã€å¿…è¦ã«ãªã‚‹ãŸã³ã«è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã®ã¯é¢å€’ã ã—ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹ã«ã‚‚ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«æ°—ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

[pycrc](https://pycrc.org/)ã¯CRCè¨ˆç®—ã‚’è¡Œã†Cè¨€èªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã§ã‚ã‚‹ã€‚

å¼•æ•°ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€Cã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨å¯¾å¿œã™ã‚‹ãƒ˜ãƒƒãƒ€ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã€‚

https://pycrc.org/ ã‹ã‚‰ã€€tar.gz ã¾ãŸã¯ zip ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å±•é–‹ã™ã‚‹ã€‚

## æ³¨æ„

ã‚„ã‚„ã“ã—ã„ã®ã§ã™ãŒã€[pycrc](https://pycrc.org/) ã¨ã¯åˆ¥ã«ã€[PyCRC](https://pycrc.readthedocs.io/en/latest/readme.html) ã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚ã‚ã‚‹ã€‚

ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ã®ã¯ã€[pycrc](https://pycrc.org/)ã§ã“ã¡ã‚‰ã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ã‚ã‚‹ã€‚
[PyCRC](https://pycrc.readthedocs.io/en/latest/readme.html) ã¯ã€€GPLv3ã€€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ã‚ã‚‹ã€‚[PyCRC](https://pycrc.readthedocs.io/en/latest/readme.html) ã«é–¢ã—ã¦ã¯èª¿æŸ»ã—ã¦ãªã„ã€‚

## ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

### CRC-32 ã®è¨ˆç®—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹

python3 ã®å ´åˆ

```
python3 pycrc.py --model crc-32 --algorithm table-driven --generate h -o crc.h
python3 pycrc.py --model crc-32 --algorithm table-driven --generate c -o crc.c
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ python ã® binascii.crc32 ãŠã‚ˆã³ zlib ã® crc32 ã¨åŒã˜ CRC ã®è¨ˆç®—ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã€‚


å‚è€ƒ: python ã®å ´åˆ

```
python pycrc.py --model crc-32 --algorithm table-driven --generate h -o crc.h
python pycrc.py --model crc-32 --algorithm table-driven --generate c -o crc.c
```

ã¾ãŸã¯

```
./pycrc.py --model crc-32 --algorithm table-driven --generate h -o crc.h
./pycrc.py --model crc-32 --algorithm table-driven --generate c -o crc.c
```

### ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹

ç”Ÿæˆã—ãŸãƒ˜ãƒƒãƒ€ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€ã¾ãŸ [tutorial ã® Write the main file](https://pycrc.org/tutorial.html#main) ã«ã‚‚ã‚ã‚‹ã¨ãŠã‚Šã€`crc_init` ã§åˆæœŸåŒ–ã—ã¦ã€`crc_update` ã§å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä¸ãˆã¦ã€`crc_finalize` ã§æœ€çµ‚çµæœã‚’ç¢ºå®šã™ã‚‹ã€‚

https://github.com/m-tmatma/pycrc-test/blob/master/main.c

```
#include <stdio.h>
#include <string.h>
#include "crc.h"

crc_t get_crc(const unsigned char* data, size_t data_len)
{
    crc_t crc = crc_init();
    crc = crc_update(crc, data, data_len);
    crc = crc_finalize(crc);
    return crc;
}

int main(void)
{
    const char * data[] = {
        "ABC",
        "12345",
    };

    for (int i = 0; i < sizeof(data) / sizeof(data[0]); i++)
    {
        printf("%s: %08lx\n", data[i],
            get_crc(data[i], strlen(data[i]))
        );
    }
    return 0;
}
```

## é–¢æ•°ã® prefix

é€šå¸¸ã¯ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã®é–¢æ•°åã¯ã€€`crc_init`ã€ `crc_update`ã€€ãŠã‚ˆã³ã€`crc_finalize` ã ãŒã€`--symbol-prefix=`ã€€ã‚’æŒ‡å®šã™ã‚‹ã¨é–¢æ•°åã«ã¤ã‘ã‚‹ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å¤‰æ›´ã§ãã‚‹ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€€`--symbol-prefix=HogeHoge_` ã‚’æŒ‡å®šã™ã‚‹ã¨ã€

```
python3 pycrc.py --model crc-32 --algorithm table-driven --generate c -o crc.c --symbol-prefix=HogeHoge_
python3 pycrc.py --model crc-32 --algorithm table-driven --generate h -o crc.h --symbol-prefix=HogeHoge_
```

`HogeHoge_init`ã€ `HogeHoge_update`ã€ `HogeHoge_finalize`ã€€ã®é–¢æ•°åã§ç”Ÿæˆã•ã‚Œã‚‹ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€`crc_init`ã€ `crc_update`ã€ `crc_finalize`ã€€ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€€`--symbol-prefix=`ã€€ã®å¼•æ•°ã‚’çœç•¥ã—ãŸå ´åˆã¯ã€`--symbol-prefix=crc_` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã®ã¨åŒã˜å‹•ä½œã‚’ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

## ç”Ÿæˆã—ãŸã‚³ãƒ¼ãƒ‰ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

https://pycrc.org/faq.html#code-ownershipã€€ã«ã¯

````
The sloppy answer is: you are free to do whatever you like
with the generated code, as long as you don't blame the author
for any malfunction or damage caused by the program.

However, as a courtesy, please keep the line that states
that the code was generated by pycrc.
````

ã¨ã‚ã‚‹ã€‚

## å®Ÿè¨¼ã‚³ãƒ¼ãƒ‰

https://github.com/m-tmatma/pycrc-test
ã«å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç™»éŒ²ã—ã¦ã„ã‚‹ã€‚

## pycrc.py ã®ãƒ˜ãƒ«ãƒ—

ä»¥ä¸‹ã¯ã€€`pycrc.py` ã®ãƒ˜ãƒ«ãƒ—ã§ã™ã€‚

```
$ python3 pycrc.py --help
Usage: python pycrc.py [OPTIONS]

To calculate the checksum of a string or hexadecimal data:
    python pycrc.py [model] --check-string "123456789"
    python pycrc.py [model] --check-hexstring "313233343536373839"

To calculate the checksum of a file:
    python pycrc.py [model] --check-file filename

To generate the C source code and write it to filename:
    python pycrc.py [model] --generate c -o filename

The model can be defined either with the --model switch or by specifying each
of the following parameters:
    --width --poly --reflect-in --xor-in --reflect-out --xor-out

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -v, --verbose         be more verbose; print the value of the parameters and
                        the chosen model to stdout
  --check-string=STRING
                        calculate the checksum of a string (default:
                        '123456789')
  --check-hexstring=STRING
                        calculate the checksum of a hexadecimal number string
  --check-file=FILE     calculate the checksum of a file
  --generate=CODE       generate C source code; choose the type from {h, c,
                        c-main, table}
  --std=STD             choose the C dialect of the generated code from {C89,
                        ANSI, C99}
  --algorithm=ALGO      choose an algorithm from {bit-by-bit, bbb, bit-by-bit-
                        fast, bbf, table-driven, tbl, all}
  --model=MODEL         choose a parameter set from {crc-5, crc-8,
                        dallas-1-wire, crc-12-3gpp, crc-15, crc-16,
                        crc-16-usb, crc-16-modbus, crc-16-genibus,
                        crc-16-ccitt, r-crc-16, kermit, x-25, xmodem, zmodem,
                        crc-24, crc-32, crc-32c, crc-32-mpeg, crc-32-bzip2,
                        posix, jam, xfer, crc-64, crc-64-jones, crc-64-xz}
  --width=NUM           use NUM bits in the polynomial
  --poly=HEX            use HEX as polynomial
  --reflect-in=BOOL     reflect the octets in the input message
  --xor-in=HEX          use HEX as initial value
  --reflect-out=BOOL    reflect the resulting checksum before applying the
                        --xor-out value
  --xor-out=HEX         xor the final CRC value with HEX
  --slice-by=NUM        read NUM bytes at a time from the input. NUM must be
                        one of the values {4, 8, 16}
  --table-idx-width=NUM
                        use NUM bits to index the CRC table; NUM must be one
                        of the values {1, 2, 4, 8}
  --force-poly          override any errors about possibly unsuitable polynoms
  --symbol-prefix=STRING
                        when generating source code, use STRING as prefix to
                        the exported C symbols
  --crc-type=STRING     when generating source code, use STRING as crc_t type
  --include-file=FILE   when generating source code, include also FILE as
                        header file; can be specified multiple times
  -o FILE, --output=FILE
                        write the generated code to file instead to stdout
```





