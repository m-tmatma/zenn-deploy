---
title: "ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® git ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦ã‚³ãƒžãƒ³ãƒ‰ä¸€æ‹¬å®Ÿè¡Œ"
emoji: "ðŸš€"
type: "tech"
topics:
  - "git"
published: true
published_at: "2022-10-30 09:04"
---

# ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® git ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦ã‚³ãƒžãƒ³ãƒ‰ä¸€æ‹¬å®Ÿè¡Œ

ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã« A, B ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚Šã€ãã®ä¸‹ã« git ãƒªãƒã‚¸ãƒˆãƒªãŒè¤‡æ•°ã‚ã‚‹ã‚ˆã†ãªçŠ¶æ³ã‚’æƒ³å®šã™ã‚‹ã€‚

```
./A/a/.git
./A/b/.git
./A/c/.git
./B/a/.git
./B/b/.git
./B/c/.git
```

## ã‚³ãƒžãƒ³ãƒ‰

```
find . -maxdepth 3 -name ".git" 2> /dev/null | xargs -r -n1 dirname | xargs -r -I{} sh -x -c "git -C {} remote update -p"
```

## èª¬æ˜Ž

### find

`-maxdepth 3` ã‚’æŒ‡å®šã—ã¦ find ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

ã“ã“ã§æœ€å¤§ã®æ·±ã•ã‚’æŒ‡å®šã™ã‚‹ã®ã¯ã€å¿…è¦ä»¥ä¸Šã«æ·±ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¤œç´¢ã—ãªã„ãŸã‚ã§ã€ã“ã‚Œã‚ˆã‚Šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®éšŽå±¤ãŒæ·±ã„å ´åˆã¯ã‚‚ã£ã¨å¤§ããªå€¤ã‚’æŒ‡å®šã™ã‚‹ã‹ã€å˜ã«æŒ‡å®šã—ãªã‘ã‚Œã°ã‚ˆã„ã€‚

ãŸã ã—ãã®å ´åˆã€æ¤œç´¢ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ã«æ³¨æ„ã€‚

```
$ find . -maxdepth 3 -name ".git"
./B/c/.git
./B/b/.git
./B/a/.git
./A/c/.git
./A/b/.git
./A/a/.git
```

### dirname

xargs ã¨ã¨ã‚‚ã« dirname ã‚’ä½¿ç”¨ã—ã¦ã€ `.git` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãŠã‹ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’å–ã‚Šå‡ºã™ã€‚

ã“ã“ã§ xargs ã®å¼•æ•°ã« `-n1` ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŒã€dirname ã‚³ãƒžãƒ³ãƒ‰ã¯å¼•æ•°ã‚’1ã¤ã—ã‹å—ã‘å–ã‚‰ãªã„ã®ã§ xargs ãŒ dirname ã‚’å‘¼ã³å‡ºã™ã¨ãã« 1ã¤ãšã¤å‘¼ã³å‡ºã™ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã€‚
xargs ã« `-r` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€æ¨™æº–å…¥åŠ›ãŒç©ºã ã£ãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã‚ˆã†ã« xargs ã®å‡¦ç†ã‚’å®Ÿè¡Œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚

```
$ find . -maxdepth 3 -name ".git" |  xargs -r -n1 dirname
./B/c
./B/b
./B/a
./A/c
./A/b
./A/a
```

### git

git ã‚³ãƒžãƒ³ãƒ‰ã¯ `-C` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã§ãã‚‹ã€‚
xargs ã® `-I` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã“ã¨ã§ã€æŒ‡å®šã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç½®æ›ã•ã›ã‚‹ã‚ˆã†ã«ã§ãã‚‹ã€‚

ä»¥ä¸‹ã®ä¾‹ã®å ´åˆ `-I {}` ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ `{}` ã®éƒ¨åˆ†ã‚’æ¨™æº–å…¥åŠ›ã‹ã‚‰ã®å…¥åŠ›ã«ç½®æ›ã§ãã‚‹ã€‚

```
xargs  -r -I{} git -C {} remote update -p
```

* https://git-scm.com/docs/git
* https://tracpath.com/docs/
* https://linuxjm.osdn.jp/html/GNU_findutils/man1/xargs.1.html

### find ã¨ xargs ã‚’çµ„ã¿åˆã‚ã›ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã§ `.git` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ã§ã®éšŽå±¤ãŒ 3 éšŽå±¤ã¾ã§ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èµ°æŸ»ã—ã¦ã€`git remote update -p` ã‚’å®Ÿè¡Œã§ãã‚‹ã€‚

```
find . -maxdepth 3 -name ".git" | xargs -r -n1 dirname | xargs -r -I{} git -C {} remote update -p
```

### xargs ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹

ä¸Šè¨˜ã ã¨ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ›´æ–°ã™ã‚‹ã®ã‹ã‚ã‹ã‚‰ãªã„ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã« `sh -x -c` çµŒç”±ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ›´æ–°ã—ã¦ã„ã‚‹ã®ã‹ã€è¡¨ç¤ºã§ãã‚‹ã€‚

```
find . -maxdepth 3 -name ".git" | xargs -r -n1 dirname | xargs -r -I{} sh -x -c "git -C {} remote update -p"
```

### find ã§ permission ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã«ç„¡è¦–ã™ã‚‹

`2> /dev/null` ã§æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’æ¨ã¦ã¦ã€permission ãªã©ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚

```
find . -maxdepth 3 -name ".git" 2> /dev/null | xargs -r -n1 dirname | xargs -r -I{} sh -x -c "git -C {} remote update -p"
```



