---
title: "Linux ã§ SSH çµŒç”±ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹"
emoji: "ğŸ™Œ"
type: "tech"
topics:
  - "linux"
  - "ssh"
  - "sshpass"
published: true
published_at: "2021-12-19 09:41"
---

# Linux ã§ SSH çµŒç”±ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹

ä»¥ä¸‹ã®è¨˜äº‹ã§ã¯ ubuntu 21.10 ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

## èª¬æ˜ã§ä½¿ç”¨ã™ã‚‹æ§‹æˆ

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

ãƒã‚·ãƒ³å: test1
IPã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.11.21
ãƒ¦ãƒ¼ã‚¶ãƒ¼: user1

### ã‚µãƒ¼ãƒãƒ¼å´

ãƒã‚·ãƒ³å: test2
IPã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.11.22
ãƒ¦ãƒ¼ã‚¶ãƒ¼: user2
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: password2

## æº–å‚™ä½œæ¥­

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚’è‡ªå‹•åŒ–ã—ãŸã„ã®ã§ `sshpass` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã€‚

```
sudo apt install -y sshpass
```

### ã‚µãƒ¼ãƒãƒ¼å´

```
sudo apt install -y openssh-server
sudo systemctl start ssh
sudo systemctl enable ssh
```

https://qiita.com/m-tmatma/items/9a562863ca99ca6c0d1c


## æ‰‹é †


### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã®æ“ä½œã®å ´åˆ

```
sshpass -p password2 ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 ls
```

### sudo æ¨©é™ãŒå¿…è¦ãªæ“ä½œã®å ´åˆ

```
sshpass -p password2 ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 "echo password2 | sudo -S dmesg"
```

## è§£èª¬

### ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ

SSH ã§ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã«æ¥ç¶šã—ã¦ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰(ä»¥ä¸‹ã®å ´åˆ ls) ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```
ssh user2@192.168.11.22 ls
```

ã—ã‹ã—ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç¢ºèªã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã‹ã¤ã€fingerprint ã®ç¢ºèªãŒè¡Œã‚ã‚Œã¾ã™ã€‚
ã“ã‚Œã ã¨è‡ªå‹•åŒ–ã§ããªã„ã®ã§ã“ã®äºŒã¤ã‚’è‡ªå‹•åŒ–ã—ãŸã„ã€‚

```
user1@test1:~$ ssh user2@192.168.11.22 ls
The authenticity of host '192.168.11.22 (192.168.11.22)' can't be established.
ECDSA key fingerprint is SHA256:*************************.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.11.22' (ECDSA) to the list of known hosts.
user2@192.168.11.22's password:
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
ãƒ“ãƒ‡ã‚ª
ãƒ”ã‚¯ãƒãƒ£
ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯
å…¬é–‹
```

### fingerprint ã®ç¢ºèªã‚’ã•ã›ãªã„ã‚ˆã†ã«ã™ã‚‹

`StrictHostKeyChecking` ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ no ã«ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ç¢ºèªã‚’ã•ã›ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
ã¾ãŸ `UserKnownHostsFile` ã§ `/dev/null` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€knownhostãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã®çŠ¶æ…‹ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šæ¥ç¶šå…ˆã®æƒ…å ±ãŒå¤‰ã‚ã£ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‰ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚(ã“ã‚Œã«ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã®ã§ã€å®‰å…¨ã¨ã„ãˆã‚‹å ´åˆã ã‘ã«é™å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚)

```
ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 ls
```

```
ser1@test1:~$ ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 ls
Warning: Permanently added '192.168.11.22' (ECDSA) to the list of known hosts.
user2@192.168.11.22's password:
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
ãƒ“ãƒ‡ã‚ª
ãƒ”ã‚¯ãƒãƒ£
ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯
å…¬é–‹
```


### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è‡ªå‹•å…¥åŠ›

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã« `sshpass` ã‚’å°å…¥ã—ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã« sshpass ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
sudo apt install -y sshpass
```

sshpass ã‚’ä½¿ã£ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚(ã“ã‚Œã«ã‚‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µãŒã‚ã‚Šã¾ã™)
`-p` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```
sshpass -p password2 ssh   -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 ls
```


### ã‚µãƒ¼ãƒãƒ¼å´ã§ sudo ãŒå¿…è¦ãªæ“ä½œã‚’å®Ÿè¡Œã™ã‚‹

ã‚µãƒ¼ãƒãƒ¼å´ã§ sudo ãŒå¿…è¦ãªæ“ä½œä¾‹ãˆã° `dmesg` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã‚µãƒ¼ãƒãƒ¼å´ã§ sudo ã‚’å®Ÿè¡Œã—ãŸéš›ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’å¾…ã£ã¦ãã‚Œãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

#### sudo ã§ã®å®Ÿè¡ŒãŒå¿…è¦ãªæ“ä½œ

```
user1@test1:~$ sshpass -p password2 ssh   -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 dmesg
Warning: Permanently added '192.168.11.22' (ECDSA) to the list of known hosts.
dmesg: ã‚«ãƒ¼ãƒãƒ«ãƒãƒƒãƒ•ã‚¡ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: è¨±å¯ã•ã‚Œã¦ã„ãªã„æ“ä½œã§ã™
```

#### sudo ã§å®Ÿè¡Œ

```
user1@test1:~$ sshpass -p password2 ssh   -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 sudo dmesg
Warning: Permanently added '192.168.11.22' (ECDSA) to the list of known hosts.
sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™
```

### sudo -S ã§å®Ÿè¡Œ

sudo ã¯ `-S` ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šæ¨™æº–å…¥åŠ›ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã§
echo ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¦ã€ãã‚Œã‚’ãƒ‘ã‚¤ãƒ—ã§ã¤ãªãã“ã¨ã«ã‚ˆã‚Š sudo ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¼•ãæ¸¡ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

```
sshpass -p password2 ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 "echo password2 | sudo -S dmesg"
```

```
user1@test1:~$ sshpass -p password2 ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  user2@192.168.11.22 "echo password2 | sudo -S dmesg"
Warning: Permanently added '192.168.11.22' (ECDSA) to the list of known hosts.
[sudo] user2 ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: [    0.000000] Linux version 5.13.0-22-generic (buildd@lgw01-amd64-012) (gcc (Ubuntu 11.2.0-7ubuntu2) 11.2.0, GNU ld (GNU Binutils for Ubuntu) 2.37) #22-Ubuntu SMP Fri Nov 5 13:21:36 UTC 2021 (Ubuntu 5.13.0-22.22-generic 5.13.19)
[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.13.0-22-generic root=UUID=7954ae94-5a21-4738-be70-942f7abeb1c3 ro quiet splash
[    0.000000] KERNEL supported cpus:
[    0.000000]   Intel GenuineIntel
[    0.000000]   AMD AuthenticAMD
[    0.000000]   Hygon HygonGenuine
[    0.000000]   Centaur CentaurHauls
[    0.000000]   zhaoxin   Shanghai
[    0.000000] Disabled fast string operations
[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'
       ...
```

### å‚è€ƒã‚µã‚¤ãƒˆ

https://qiita.com/m-tmatma/items/9a562863ca99ca6c0d1c

https://qiita.com/koara-local/items/1aec16a4f866844f546d

https://siguniang.wordpress.com/2014/02/28/get-rid-of-openssh-warning-message/







