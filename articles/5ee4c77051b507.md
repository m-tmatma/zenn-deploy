---
title: "pandas ã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰åŒ–ç‚¹ã®ã¿ã‚’å–ã‚Šå‡ºã™"
emoji: "ğŸ•Œ"
type: "tech"
topics:
  - "markdown"
  - "pandas"
published: true
published_at: "2022-10-07 13:59"
---

# pandas ã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰åŒ–ç‚¹ã®ã¿ã‚’å–ã‚Šå‡ºã™

DataFrame ã®ç‰¹å®šã®åˆ—ãŒå¤‰åŒ–ã—ãŸè¡Œã®ã¿å–ã‚Šå‡ºã™

## ã‚³ãƒ¼ãƒ‰

ä»¥ä¸‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ä¹±æ•°ã§å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã£ã¦ã„ã‚‹ãŸã‚ã€å®Ÿè¡Œã—ã¦ã‚‚èª¬æ˜ã§è¨˜è¼‰ã®ãƒ‡ãƒ¼ã‚¿ã¨ä¸€è‡´ã—ãªã„ã€‚(ä¸€è‡´ã™ã‚‹ã¨ã¯é™ã‚‰ãªã„)

https://github.com/m-tmatma/pandas-test/blob/8d3fe849eb345045be1c78213c63eadaa6548e51/state_change.py

## èª¬æ˜

`df` ã« pandas ã® DataFrame ãŒå…¥ã£ã¦ã„ã‚‹ã¨ã™ã‚‹ã€‚
`state` ãŒå¤‰åŒ–ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã„ã¨ã™ã‚‹ã€‚

### df

ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ (ä¹±æ•°ã‚’ä½¿ã£ã¦ç”Ÿæˆ)

|    |   x |   y |   state |
|---:|----:|----:|--------:|
|  0 |   0 | 100 |       3 |
|  1 |   1 | 101 |       1 |
|  2 |   2 | 102 |       0 |
|  3 |   3 | 103 |       1 |
|  4 |   4 | 104 |       1 |
|  5 |   5 | 105 |       1 |
|  6 |   6 | 106 |       1 |
|  7 |   7 | 107 |       2 |
|  8 |   8 | 108 |       1 |
|  9 |   9 | 109 |       0 |


### df.shift()

1è¡Œä¸‹ã« shift

|    |   x |   y |   state |
|---:|----:|----:|--------:|
|  0 | nan | nan |     nan |
|  1 |   0 | 100 |       3 |
|  2 |   1 | 101 |       1 |
|  3 |   2 | 102 |       0 |
|  4 |   3 | 103 |       1 |
|  5 |   4 | 104 |       1 |
|  6 |   5 | 105 |       1 |
|  7 |   6 | 106 |       1 |
|  8 |   7 | 107 |       2 |
|  9 |   8 | 108 |       1 |

### states != states.shift()

`state` ã‚’ä¸‹ã« 1è¡Œ shift ã—ãŸã‚‚ã®ã¨ã‚ªãƒªã‚¸ãƒŠãƒ«ãŒç­‰ã—ã„ã‹åˆ¤æ–­ã™ã‚‹ã€‚
å¤‰åŒ–ç‚¹ã«ãªã‚‹è¡Œã®å ´åˆ `change` ã®å€¤ãŒ True ã«ãªã‚‹ã€‚

```
states = df['state']
df['change'] = states != states.shift()
```

df ã« `change` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚

|    |   x |   y |   state | change   |
|---:|----:|----:|--------:|:---------|
|  0 |   0 | 100 |       3 | True     |
|  1 |   1 | 101 |       1 | True     |
|  2 |   2 | 102 |       0 | True     |
|  3 |   3 | 103 |       1 | True     |
|  4 |   4 | 104 |       1 | False    |
|  5 |   5 | 105 |       1 | False    |
|  6 |   6 | 106 |       1 | False    |
|  7 |   7 | 107 |       2 | True     |
|  8 |   8 | 108 |       1 | True     |
|  9 |   9 | 109 |       0 | True     |

### df[ df['change'] ]

`df['change']` ãŒ True ã§ã‚ã‚‹è¦ç´ ã®ã¿ df ã‹ã‚‰å–ã‚Šå‡ºã—ã¦åˆ¥ã® DataFrame (`dfChange`) ã«æ ¼ç´ã™ã‚‹ã€‚

```
dfChange = df[ df['change'] ]
```

dfChange (`df` ã§ `state` ã®å€¤ãŒå¤‰åŒ–ã—ãŸè¦ç´ ã®ã¿å«ã‚“ã§ã„ã‚‹)

|    |   x |   y |   state | change   |
|---:|----:|----:|--------:|:---------|
|  0 |   0 | 100 |       3 | True     |
|  1 |   1 | 101 |       1 | True     |
|  2 |   2 | 102 |       0 | True     |
|  3 |   3 | 103 |       1 | True     |
|  7 |   7 | 107 |       2 | True     |
|  8 |   8 | 108 |       1 | True     |
|  9 |   9 | 109 |       0 | True     |