---
title: "pandas ã® DataFrame(datetime.datetimeå«ã‚€)ã‚’ Excel ã«ä¿å­˜ã™ã‚‹"
emoji: "ðŸŽƒ"
type: "tech"
topics:
  - "excel"
  - "pandas"
published: true
published_at: "2022-12-17 14:29"
---

# pandas ã® DataFrame(datetime.datetimeå«ã‚€)ã‚’ Excel ã«ä¿å­˜ã™ã‚‹

## ã‚„ã‚ŠãŸã„ã“ã¨

* DataFrame ã‚’ Excel ã«ä¿å­˜ã™ã‚‹
* datetime.datetime ã®ãƒ‡ãƒ¼ã‚¿ã‚’microsec å˜ä½ã¾ã§ã®æƒ…å ±ã‚’å«ã‚ã‚‹
* ãƒ‡ãƒ¼ã‚¿ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«åˆ—ã®å¹…ã‚’èª¿æ•´ã™ã‚‹
* `A1` ã‚»ãƒ«ã§ `ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æž ã®å›ºå®š` ã‚’è¡Œã†ã€‚

## ãƒã‚¤ãƒ³ãƒˆ

* pd.ExcelWriter ã‚’ç”Ÿæˆã—ã¦ã€DataFrame ã® to_excel ã‚’å‘¼ã‚“ã§ Excel ã«ä¿å­˜ã™ã‚‹
* DataFrame ã® to_excel ã§ freeze_panes ã‚’æŒ‡å®šã—ã¦ã€`ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æž ã®å›ºå®š` ã‚’è¡Œã†ã€‚
   * `(1, 1)` ã®æŒ‡å®šã§ã€å·¦å´ãŒè¡Œ(=1)ã€å³å´ãŒåˆ—(=A)ã€‚
* DataFrame ã‚’Excel ã«ä¿å­˜ã™ã‚‹å ´åˆã€ç§’ç²¾åº¦ã¾ã§ã§ã‚ã‚Œã°ã€ pandas.ExcelWriter ã® datetime_format(https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.html) ã« `'YYYY-MM-DD HH:MM:SS'` ã‚’æ¸¡ã™ã“ã¨ã§ã€ç§’ç²¾åº¦ã¾ã§è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
* microsec å˜ä½ã¾ã§ã®æƒ…å ±ã‚’è¡¨ç¤ºã•ã›ãŸã„ã®ã§ã€æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã€‚
* pandas.ExcelWriter ã® sheets (https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.sheets.html) ã§ set_column ã‚’å‘¼ã¶ã“ã¨ã§åˆ—ã®å¹…ã‚’è¨­å®šã™ã‚‹ã€‚

## ãƒªãƒ³ã‚¯

* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.html
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.sheets.html
* https://towardsdatascience.com/how-to-auto-adjust-the-width-of-excel-columns-with-pandas-excelwriter-60cee36e175e

## å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
pip install pandas openpyxl numpy xlsxwriter
```

## ã‚³ãƒ¼ãƒ‰

* https://github.com/m-tmatma/pandas-test/blob/main/to_datetime.py

```
#!/usr/bin/python3
"""
This script demonstrates writing dataframe to excel.

Prepare
   pip install pandas openpyxl numpy xlsxwriter

See
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_excel.html
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.html
* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.ExcelWriter.sheets.html
* https://towardsdatascience.com/how-to-auto-adjust-the-width-of-excel-columns-with-pandas-excelwriter-60cee36e175e
"""
import datetime
import pandas as pd
import numpy as np

def timedata(i):
    '''
    return test data.
    '''
    return datetime.datetime.now() + datetime.timedelta(microseconds=i*1001*1001)

df = pd.DataFrame(
    {
        'timestamp': [ timedata(i) for i in range(10)],
        'random': np.random.random(10),
    }
)
df['timestamp'] = df['timestamp'].dt.strftime('%Y-%m-%d %H:%M:%S.%f')

with pd.ExcelWriter('timestamp-test.xlsx') as writer:
    sheet_name='Test'

    # freeze_panes to (1, 1) => A1
    df.to_excel(writer, sheet_name=sheet_name, index=False, freeze_panes=(1, 1))

    for column in df:
        column_width = max(df[column].astype(str).map(len).max(), len(column))
        col_idx = df.columns.get_loc(column)
        writer.sheets[sheet_name].set_column(col_idx, col_idx, column_width)
```